<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTTP</title>
</head>
<body>
    

    <div>
        <p></p>
    </div>

    <!-- <div class=""></div> -->


    <script>


        async function getPosts() {
            // try {
            //     throw 'myException'; // generates an exception
            // } catch (e) {
            //     // statements to handle any exceptions
            //     console.log(e); // pass exception object to error handler
            // }
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts/1'); // .then(() => Promise.reject('Got strange error!'));
                console.log('response: ', response);
                const data = await response.json();

                if (!Object.values(data).length) {
                    throw 'Err!!!!';
                }

                console.log('get posts: ', data);
            } catch(err) {
                console.error('catch: ', err);
                // throw new Error({});
            }
        }

        getPosts();


        // let isGender = 'female';
        // let name

        // if (isGender === 'female') {
        //     name = 'Jessi';
        // } else {
        //     name = 'John';
        // }

        // const name = isGender === 'male' ? 'John' : 'Jessi';

        
        // function abc(param1, cb) {
        //     // afasfasf
        //     cb(function (cb) {
        //         // asffas
        //         cb(function() {

        //         })
        //     })
        // }


        fetch('https://jsonplaceholder.typicode.com/posts', {
            method: 'GET'
        }).then(data => {
            // console.log('data: ', data.json());
            // console.log(data);
            // debugger;
            return data.json();
        }).then(d => {
            // console.log('data: ', d);
        })

        function test() {
            return new Promise(function(success, abort) {
                if (Math.random() > .5) {
                    success('DONE!');
                } else {
                    abort('ISSUE');
                }
            })
        }

        test()
            .then(function(param) {
                console.log(param);
            })
            .catch(function(param) {
                console.log(param);
            })

        function abc() {
            return Promise.resolve('Error ???');
            // return Promise.reject('Error ???');
        }

        // abc().then(function() {
        //     console.log('abc work!');
        // }).catch(function(m) {
        //     console.log('m: ', m);
        // })

        // new Promise
        function getName(name) {
            return Promise.resolve(name);
        }

        const promise = getName('Misha');

        // class Person {
        //     constructor
        // }

        // function User(name, age) {
        //     this.name = name;
        //     this.age = age;
        //     // this.sayHi = function(greeting) {
        //     //     console.log(greeting + this.name);
        //     // }
        // }

        // User.prototype.sayHello = function(greeting) {
        //     return greeting + ' ' + this.name;
        // }

        // function Profile() {
        //     this.adress = 'test'
        // }

        // User.prototype = Object.create(Profile.prototype);

        // const user = new User('Alex', 24);
        // const user2 = new User('Vlad', 34);
        // console.log('user: ', user);
        // console.log('user2: ', user2);


        function fetchAPI(method, url, body) {
            return new Promise(function(resolve, reject) {
                const xhr = new XMLHttpRequest();

                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if ( xhr.status === 200 || xhr.status === 201) {
                            resolve(xhr.responseText);
                            // console.log(JSON.parse(xhr.responseText));
                        } else {
                            reject({
                                message: 'Something went wrong!',
                                status: 404,
                                data: {}
                            });
                            // console.error('Something went wrong!');
                        }
                    }
                }

                xhr.open(method, url);

                setTimeout(function() {
                    if (body) {
                        xhr.send(JSON.stringify(body));
                    } else {
                        xhr.send();
                    }
                }, 2000);
            });
        }

        // GET
        fetchAPI('GET', 'https://jsonplaceholder.typicode.com/posts')
            .then(function(response) {
                return JSON.parse(response);
            })
            .then(function(data) {
                // console.log('data: ', data);
                // for (let post of data) {
                //     console.log(post);
                // }
            })
            .catch(function(err) {
                console.log(err.status);
            })


        // POST
        fetchAPI('POST', 'https://jsonplaceholder.typicode.com/posts', {
            title: 'my new post',
            body: 'some text',
            userId: 1,
        })
            .then(function(response) {
                return JSON.parse(response);
            })
            .then(function(post) {
                console.log('Create post: ', post);
            })
            .catch(function(err) {
                console.log(err.status);
            })
        
    </script>

</body>
</html>